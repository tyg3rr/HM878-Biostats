---
editor_options:
  markdown:
    wrap: 200
output:
  html_document: default
  word_document: default
  pdf_document: default
---

# HM 878 Applied Biostatistics Problem Set #1b

## T-tests, ANOVA, Chi-Square, Correlation, Simple and Multivariate Linear Regression

*This Problem Set will provide students with the opportunity to learn how to use R to conduct basic statistical tests, replicating many tests that were already done in HM 802. The main goal is to make
sure you are familiar with R as a system for statistical analysis. Again, output from SPSS from HM 802 is included for comparison.*

Analyses include:

-   Independent t-test
-   ANOVA
-   Chi-square
-   Correlation
-   Simple and multivariate linear regression

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

*Setting up the code environment*

```{r}
library(dplyr)
```

```{r}
library(tidyverse)
```

```{r}
library(car)
```

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

## Question 1

Is there a difference in knowledge scores between groups based on sex? Data: COVID-19 Knowledge.csv. Variables: Male and Knowledge Score. Use R to conduct an independent samples t-test using "Male" as
the grouping variable, and "Knowledge Score" as the dependent variable. Calculate and report the appropriate descriptive statistics, and include the Levene's test for equality of variances.

```{r}
df = read.csv("C:\\Users\\ljens\\Downloads\\COVID-19 Knowledge, Attitudes, and Behaviors.csv")
```

```{r}
df$Male <- factor(df$Male)
```

```{r}
df[df$Male == 'Male',"KnowledgeScore"] |> summary(KnowledgeScore)
```

```{r}
df[df$Male == 'Female','KnowledgeScore'] |> summary(KnowledgeScore)
```

```{r}
ggplot(data = df, aes(x=Male, y=KnowledgeScore)) + 
  geom_boxplot()
```

Levene's Test is performed to check for homogeneity of KnowledgeScore variances between Males and Females.

Null hypothesis: KnowledgeScore variance is equal between the groups.

Alt hypothesis: KnowledgeScore variance is different between the groups.

alpha = 0.05

```{r}
leveneTest(KnowledgeScore ~ Male, df)
```

Levene's test returned p = 0.001, so null is rejected. Mean variances are not homogeneous. We proceed to the t-test.

Null hypothesis: There's no difference in KnowledgeScore means between the two measured genders

Alt hypothesis: Mean KnowledgeScore differs between the two measured genders.

alpha = 0.05

```{r}
t = t.test(df$KnowledgeScore ~ df$Male, var.equal=FALSE)
```

```{r}
t
```

```{r}
print(paste('Female Mean: ',as.character(t$estimate)[1]))
```

```{r}
print(paste('Male Mean: ',as.character(t$estimate)[2]))
```

```{r}
print(paste('p-value: ',as.character(t$p.value)))
```

The p-value is lower than alpha, so the null is rejected and we assume that there is a significant difference in mean knowledge scores between the two measured genders.

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

## Question 2

Is there a difference in knowledge scores among groups based on generational categories? Data: COVID-19 Knowledge.csv. Variables: Generations and Knowledge Score. Use R to conduct an ANOVA using
"Generations" as the grouping variable, and "Knowledge Score" as the dependent variable. Generate appropriate descriptive stats, and if applicable, generate and interpret post hoc tests.

```{r}
aggregate(KnowledgeScore ~ Generations, data=df, function(x) round(c(mean=mean(x), sd=sd(x))))
```

```{r}
ggplot(data = df, aes(x=Generations, y=KnowledgeScore)) + 
  geom_boxplot()
```

```{r}
nova = aov(KnowledgeScore ~ Generations, data = df)
```

```{r}
hist(nova$residuals)
```

```{r}
qqPlot(nova$residuals, id=FALSE)
```

```{r}
shapiro.test(nova$residuals)

# tests null hypothesis that residuals are norml
```

The residuals are definitely not normal!

```{r}
summary(nova)
```

```{r}
TukeyHSD(nova)
```

```{r}
plot(TukeyHSD(nova))
```

Significant differences are seen between Boomers and basically every other generation. In other words, Boomers had higher Knowledge Scores than every other generation.

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

## Question 3

Is there an association between political party ideology/identification and whether respondents report that COVID-19 will be successfully controlled? Data: COVID-19 Knowledge.csv. Variables: RepDemInd
and SuccessControl. Use R to conduct a chi-square analysis to determine if there is an association between the two variables.

```{r}
df = read.csv("C:\\Users\\ljens\\Downloads\\COVID-19 Knowledge.csv")
```

```{r}
colnames(df)

```

```{r}
df = df |> mutate(RepDemInd = as.character(RepDemInd))
```

```{r}
df = df |> mutate(SuccessControl = as.character(SuccessControl))
```

Null hypothesis: No association between political ideology and predicted COVID control.

Alt hypothesis: Political ideology and predicted COVID control are associated.

alpha = 0.05

```{r}
chisq.test(x=df$RepDemInd, y=df$SuccessControl, correct=FALSE)
```

P-value is lower than alpha, so we reject the null and assume that the two variables are associated.

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

## Question 4

Is there a correlation between the number of cigarettes smoked per day and BMI? Data: Cigarettes Smoked_BMI.csv. Variable: CigarettesSmoked and BMI. Using R, calculate a correlation coefficient and
determine statistical significance. Second, using R, conduct a simple linear regression to predict BMI using CigarettesSmoked.

```{r}
df = read.csv("C:\\Users\\ljens\\Downloads\\Cigarettes Smoked_BMI.csv")
```

```{r}
colnames(df)
```

Testing normality of CigarettesSmoked (not normal).

```{r}
shapiro.test(df$CigarettesSmoked)
```

Testing normality of BMI (not normal)

```{r}
shapiro.test(df$BMI)
```

Using Pearson's test to test for correlation between CigarettesSmoked and BMI

```{r}
cor.test(x=df$CigarettesSmoked, y=df$BMI, method="pearson")
```

As stated, the two variables have statistically significant correlation.

```{r}
print(paste("Pearson Correlation Coefficient: ", as.character(cor.test(x=df$CigarettesSmoked, y=df$BMI, method="pearson")$estimate)))
```

```{r}
print(paste("Pearson P-Value: ", as.character(cor.test(x=df$CigarettesSmoked, y=df$BMI, method="pearson")$p.value)))
```

Let's see how the relationship looks in a chart.

```{r}
ggplot(df, aes(x=CigarettesSmoked, y=BMI)) +
  geom_point() +
  stat_smooth()
```

```{r}
model = lm(BMI ~ CigarettesSmoked, data = df)
```

```{r}
corr.coef = model$coefficients[2]
```

```{r}
corr.incpt = model$coefficients[1]
```

```{r}
print(paste('Linear Model: BMI = ', corr.coef, '* CigarettesSmoked + ', corr.incpt ))
```

Each (daily?) cigarette smoked increased BMI by 0.35

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

## Question 5

Run a Multiple Linear Regression. Data: Multiple Linear Regression Data, with Dependent variable: BMI5. Independent variables: HLTHPLN1, RFSMOK3, VEGESU1, and SEX. Remember to test for assumptions for
doing a linear regression: equality of variances, multicollinearity, and outliers in the dependent variables. When doing the linear regression remember to also generate Collinearity Statistics and
VIF, as well as a Normal P-P Plot to test for normality of residuals.
